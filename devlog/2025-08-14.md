# Devlog — 2025-08-14

Summary
- Added a manual workflow `./.github/workflows/extract_captions.yml` to extract captions from a provided video URL via `workflow_dispatch`.
- Investigated a failed run for run `16960578039` when extracting captions for `https://www.youtube.com/watch?v=F09EK4ztG34`.

What happened
- The `extract_captions` job failed during the `yt-dlp` step with:

  ```
  ERROR: Sign in to confirm you’re not a bot. Use --cookies-from-browser or --cookies for the authentication.
  ```

- This is an access/authentication restriction from YouTube for that video; `yt-dlp` exits non-zero when it cannot bypass the bot challenge.

Actions taken / recommendations
- Workflow: created `extract_captions.yml` (manual trigger) that:
  - Accepts `video_url`, optional `issue_number`, and `output_format` inputs.
  - Attempts manual subtitles first, then falls back to auto-generated (`en,ru`).
  - Converts VTT/TTML to JSON when converters are available and can comment on an issue or push results.

- Fix options for the YouTube anti-bot issue:
  1. Provide cookies to `yt-dlp` on the runner:
     - Export cookies from your browser and store as a repo secret (or base64-encode the file and store that).
     - Add a workflow step to write the secret to `cookies.txt` and pass `--cookies cookies.txt` to `yt-dlp`.
  2. Run `yt-dlp --cookies-from-browser` locally (works on your machine only, not on GitHub-hosted runners).
  3. Use the YouTube Data API or owner-provided access if appropriate.
  4. Use a different video that does not require sign-in.

Using transcripts attached to issues
- Two simple approaches the workflow can use:
  1. Put transcript text directly in the issue body (or in a fenced code block). A workflow triggered by an issue event can read `github.event.issue.body` and save it to a file.
  2. Attach/upload the transcript file to an issue (drag-and-drop). The comment will contain a public URL; the workflow can parse that URL and `curl`/`fetch` it, using `GITHUB_TOKEN` if authentication is required.

Example snippets
- Save issue body to a file (in a workflow step using `actions/github-script`):

```js
const fs = require('fs');
const body = context.payload.issue?.body || '';
fs.writeFileSync('transcript.txt', body);
```

- Download an attached file URL found in the issue body (requires `GITHUB_TOKEN` for private content):

```js
const match = body.match(/https?:\/\/[^\s)]+/);
if (!match) throw new Error('No URL found in issue body');
const url = match[0];
const res = await fetch(url, { headers: { authorization: `token ${process.env.GITHUB_TOKEN}` } });
const text = await res.text();
fs.writeFileSync('transcript.txt', text);
```

Notes
- Prefer plain text in the issue body or a fenced code block for the simplest pipeline.
- Storing cookies in repo secrets is sensitive; keep secrets scoped correctly and remove them when no longer needed.

Recorded by: automated devlog entry
